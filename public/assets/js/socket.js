"use strict";var chats,selectedUser;$(document).ready(function(){$("#back-btn").on("click",function(){selectedUser="",$(".select-box").removeClass("selected-box"),$("#utils-pane").show("slow"),$("#chat-pane").hide("slow")});var r=io("",{autoConnect:!1});r.connect(),r.on("my chats",function(e,s){if(0==$("#user-pane").children().length){chats=e;for(var a=0;a<e.length;a++){var n=e[a];s&&s.includes(n.userid)?$("#user-pane").append("\n                    <div data-userid=".concat(n.userid,' class="select-box d-flex">\n                        <div class="fas fa-user my-auto user-pane-img"></div>\n                        <div class="select-box-username my-auto">&nbsp;').concat(n.username,'</div>\n                        <div class="fas fa-envelope notify text-success ml-auto my-auto"></div>\n                    </div>\n                    ')):$("#user-pane").append("\n                    <div data-userid=".concat(n.userid,' class="select-box d-flex">\n                        <div class="fas fa-user my-auto user-pane-img"></div>\n                        <div class="select-box-username my-auto">&nbsp;').concat(n.username,'</div>\n                        <div class="notify text-success ml-auto"></div>\n                    </div>\n                    '))}c()}});var s=0;function c(){$(".select-box").click(function(){$("#utils-pane").hide("slow"),$("#chat-pane").show("slow"),$(".select-box").removeClass("selected-box");var e=$(this);e.addClass("selected-box"),selectedUser=e.attr("data-userid"),r.emit("removeUnread",selectedUser),e.children(".notify").removeClass("fas fa-envelope my-auto"),$("#selcted-user-details").removeAttr("hidden"),$("#message-pane").removeAttr("hidden"),$("#type-pane").removeClass("d-none").addClass("d-flex");var s=e.children(".select-box-username").text();$("#chat-username").text(s);var e=e.attr("data-userid");$("#chat-username-link").attr("href","/profile/".concat(e));var a=$("#message-pane");a.html("");for(var n=0;n<chats.length;n++){var t=chats[n];if(t.userid==selectedUser&&t.messages){for(var c=0;c<t.messages.length;c++)1==t.messages[c].who?a.append('\n                                <div class="message-rec d-flex flex-row">\n                                    <span class="left-triangle"></span>\n                                    <span class="message">'.concat(t.messages[c].msg,"</span>\n                                </djv>\n                            ")):a.append('\n                                <div class="message-sent d-flex flex-row-reverse">\n                                    <span class="right-triangle"></span>\n                                    <span class="message">'.concat(t.messages[c].msg,"</span>\n                                </div>\n                            "));break}}e="message-pane",(e=document.getElementById(e)).scrollTop=e.scrollHeight-e.clientHeight})}r.on("connect_error",function(e){s<=0&&(s+=1,alert("Lost chat server connection!"))}),r.on("private message",function(e){for(var s=e.content,a=e.from,n=0;n<chats.length;n++){var t=chats[n];if(t.userid==a.userid){chats[n].messages.push({who:1,msg:s}),a.userid==selectedUser?$("#message-pane").append('\n                        <div class="message-rec d-flex flex-row">\n                            <span class="left-triangle"></span>\n                            <span class="message">'.concat(s,"</span>\n                        </djv>\n                    ")):$("div .select-box[data-userid="+t.userid+"]").children(".notify").addClass("fas fa-envelope my-auto");break}}n==chats.length&&(chats.push({userid:a.userid,username:a.username,messages:[{who:1,msg:s}]}),$("#user-pane").append("\n                <div data-userid=".concat(a.userid,' class="select-box d-flex">\n                    <div class="fas fa-user my-auto user-pane-img"></div>\n                    <div class="select-box-username my-auto">&nbsp;').concat(a.username,'</div>\n                    <div class="fas fa-envelope notify text-success ml-auto my-auto"></div>\n                </div>\n            ')),c())}),$("#send-btn").click(function(){var e,s,a=$(".selected-box").attr("data-userid"),n=$("#send-message").val();if(a&&n){for(r.emit("private message",{content:n,to:a}),$("#send-message").val(""),i=0;i<chats.length;i++)if(chats[i].userid==a){chats[i].messages.push({who:0,msg:n});break}$messages=$("#message-pane"),$messages.append('\n                <div class="message-sent d-flex flex-row-reverse">\n                    <span class="right-triangle"></span>\n                    <span class="message">'.concat(n,"</span>\n                </div>\n            ")),e="message-pane",s=document.getElementById(e),$("#"+e).animate({scrollTop:s.scrollHeight-s.clientHeight},500)}}),$("#chat-pane").hide(),$(".back-to-top .fa-arrow-up").hide()});