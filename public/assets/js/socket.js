"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,s){if(e){if("string"==typeof e)return _arrayLikeToArray(e,s);var a=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(a="Object"===a&&e.constructor?e.constructor.name:a)||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,s):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,s){(null==s||s>e.length)&&(s=e.length);for(var a=0,n=new Array(s);a<s;a++)n[a]=e[a];return n}var chats,selectedUser;$(document).ready(function(){$("#back-btn").on("click",function(){selectedUser="",$(".select-box").removeClass("selected-box"),$("#utils-pane").show("slow"),$("#chat-pane").hide("slow")});var o=io("",{autoConnect:!1});o.connect(),o.on("my chats",function(e,s,a){if(0==$("#user-pane").children().length&&0<a.length){chats=e;for(var n=new Map,t=0;t<e.length;t++)n[e[t].userid]=e[t];s=_toConsumableArray(new Set(s));for(var r=0;r<a.length;r++){var o=n[a[r]];s&&s.includes(o.userid)?$("#user-pane").append("\n                    <div data-userid=".concat(o.userid,' class="select-box d-flex">\n                        <div class="fas fa-user my-auto user-pane-img"></div>\n                        <div class="select-box-username my-auto">&nbsp;').concat(o.username,'</div>\n                        <div class="fas fa-envelope notify text-success ml-auto my-auto"></div>\n                    </div>\n                    ')):$("#user-pane").append("\n                    <div data-userid=".concat(o.userid,' class="select-box d-flex">\n                    <div class="fas fa-user my-auto user-pane-img"></div>\n                        <div class="select-box-username my-auto">&nbsp;').concat(o.username,'</div>\n                        <div class="notify text-success ml-auto"></div>\n                    </div>\n                    '))}c()}});var s=0;function c(){$(".select-box").click(function(){$("#utils-pane").hide("slow"),$("#chat-pane").show("slow"),$(".select-box").removeClass("selected-box");var e=$(this);e.addClass("selected-box"),selectedUser=e.attr("data-userid"),o.emit("removeUnread",selectedUser),e.children(".notify").removeClass("fas fa-envelope my-auto"),$("#selcted-user-details").removeAttr("hidden"),$("#message-pane").removeAttr("hidden"),$("#type-pane").removeClass("d-none").addClass("d-flex");var s=e.children(".select-box-username").text();$("#chat-username").text(s);var e=e.attr("data-userid");$("#chat-username-link").attr("href","/profile/".concat(e));var a=$("#message-pane");a.html("");for(var n=0;n<chats.length;n++){var t=chats[n];if(t.userid==selectedUser&&t.messages){for(var r=0;r<t.messages.length;r++)1==t.messages[r].who?a.append('\n                                <div class="message-rec d-flex flex-row">\n                                    <span class="left-triangle"></span>\n                                    <span class="message">'.concat(t.messages[r].msg,"</span>\n                                </djv>\n                            ")):a.append('\n                                <div class="message-sent d-flex flex-row-reverse">\n                                    <span class="right-triangle"></span>\n                                    <span class="message">'.concat(t.messages[r].msg,"</span>\n                                </div>\n                            "));break}}e="message-pane",(e=document.getElementById(e)).scrollTop=e.scrollHeight-e.clientHeight})}o.on("connect_error",function(e){s<=0&&(s+=1,alert("Lost chat server connection!"))}),o.on("private message",function(e){for(var s=e.content,a=e.from,n=0;n<chats.length;n++){var t,r=chats[n];if(r.userid==a.userid){chats[n].messages.push({who:1,msg:s}),a.userid==selectedUser?($("#message-pane").append('\n                        <div class="message-rec d-flex flex-row">\n                            <span class="left-triangle"></span>\n                            <span class="message">'.concat(s,"</span>\n                        </djv>\n                    ")),(t=$("div .select-box[data-userid="+r.userid+"]")).parent().prepend(t)):((t=$("div .select-box[data-userid="+r.userid+"]")).children(".notify").addClass("fas fa-envelope my-auto"),o.emit("addUnread",r.userid),t.parent().prepend(t));break}}n==chats.length&&(chats.push({userid:a.userid,username:a.username,messages:[{who:1,msg:s}]}),$("#user-pane").append("\n                <div data-userid=".concat(a.userid,' class="select-box d-flex">\n                    <div class="fas fa-user my-auto user-pane-img"></div>\n                    <div class="select-box-username my-auto">&nbsp;').concat(a.username,'</div>\n                    <div class="fas fa-envelope notify text-success ml-auto my-auto"></div>\n                </div>\n            ')),c())}),$("#send-btn").click(function(){var e,s,a=$(".selected-box").attr("data-userid"),n=$("#send-message").val();if(a&&n){o.emit("private message",{content:n,to:a}),$("#send-message").val("");for(var t=0;t<chats.length;t++){var r=chats[t];if(r.userid==a){chats[t].messages.push({who:0,msg:n});r=$("div .select-box[data-userid="+r.userid+"]");r.parent().prepend(r);break}}$("#message-pane").append('\n                <div class="message-sent d-flex flex-row-reverse">\n                    <span class="right-triangle"></span>\n                    <span class="message">'.concat(n,"</span>\n                </div>\n            ")),e="message-pane",s=document.getElementById(e),$("#"+e).animate({scrollTop:s.scrollHeight-s.clientHeight},500)}}),$("#chat-pane").hide(),$(".back-to-top .fa-arrow-up").hide()});